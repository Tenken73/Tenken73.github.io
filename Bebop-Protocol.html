<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bebop Protocol | Anime Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            --accent-1: #667eea;
            --accent-2: #764ba2;
            --bg-primary: #0a0e27;
            --bg-secondary: #1a1f3a;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(102, 126, 234, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            color: var(--text-primary);
            min-height: 100vh;
        }

        nav {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 220px;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-right: 1px solid var(--border-color);
            z-index: 100;
        }

        .logo {
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.5rem;
            text-decoration: none;
        }

        .nav-links {
            list-style: none;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .nav-links li a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.7rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .nav-links li a:hover, .nav-links li a.active {
            color: var(--text-primary);
            background: rgba(102, 126, 234, 0.2);
            border-left: 3px solid var(--accent-1);
        }

        .nav-links li a i { width: 20px; }

        /* Main Content */
        .main-content {
            margin-left: 220px;
            padding: 2rem;
            min-height: 100vh;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        /* Tab Content */
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Sub-tabs */
        .sub-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
        }

        .sub-tab {
            padding: 0.5rem 1rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .sub-tab:hover { border-color: var(--accent-1); }
        .sub-tab.active { background: var(--accent-1); color: white; border-color: var(--accent-1); }

        .sub-content { display: none; }
        .sub-content.active { display: block; }

        /* Cards */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .card:hover { border-color: var(--accent-1); }

        .card h3 {
            color: var(--accent-1);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        /* Grids */
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }

        @media (max-width: 1200px) { .grid-3 { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            nav { width: 60px; }
            nav .nav-text { display: none; }
            .main-content { margin-left: 60px; padding: 1rem; }
        }

        /* Stats */
        .stat-card {
            text-align: center;
            padding: 1.25rem;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-1);
        }

        .stat-label { color: var(--text-secondary); font-size: 0.85rem; }

        /* Section Title */
        .section-title {
            font-size: 1.6rem;
            color: var(--accent-1);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Featured Picks */
        .featured-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1200px) { .featured-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .featured-grid { grid-template-columns: 1fr; } }

        .featured-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .featured-card:hover {
            border-color: var(--accent-1);
            transform: translateY(-3px);
        }

        .featured-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .featured-info {
            padding: 1rem;
        }

        .featured-info h4 {
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
        }

        .featured-info p {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .featured-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            background: rgba(102, 126, 234, 0.2);
            color: var(--accent-1);
            border-radius: 4px;
            font-size: 0.7rem;
            margin-top: 0.5rem;
        }

        /* Anime List */
        .anime-list { display: flex; flex-direction: column; gap: 0.75rem; }

        .anime-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .anime-item:hover {
            border-color: var(--accent-1);
            background: rgba(102, 126, 234, 0.1);
        }

        .anime-poster {
            width: 60px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .anime-info { flex: 1; }
        .anime-title { font-weight: 600; margin-bottom: 0.25rem; }
        .anime-meta { color: var(--text-secondary); font-size: 0.85rem; }

        .anime-scores {
            display: flex;
            gap: 1rem;
            text-align: center;
        }

        .score-box {
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            min-width: 50px;
        }

        .score-value { font-weight: 700; color: var(--accent-1); }
        .score-label { font-size: 0.7rem; color: var(--text-secondary); }

        /* Controls */
        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 12px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .control-group label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        select, input[type="text"] {
            padding: 0.5rem 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.9rem;
            min-width: 140px;
        }

        select:focus, input:focus { outline: none; border-color: var(--accent-1); }

        .btn {
            padding: 0.5rem 1rem;
            background: var(--accent-1);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn:hover { background: var(--accent-2); }

        /* Charts */
        .chart-container {
            height: 280px;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid var(--border-color);
        }

        /* Tags */
        .tag {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            background: rgba(102, 126, 234, 0.2);
            color: var(--accent-1);
            border-radius: 4px;
            font-size: 0.75rem;
            margin-right: 0.25rem;
            margin-bottom: 0.25rem;
        }

        /* Awards Cards */
        .award-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .award-card:hover { border-color: var(--accent-1); }

        .award-emoji { font-size: 2rem; margin-bottom: 0.5rem; }
        .award-name { font-weight: 600; margin-bottom: 0.5rem; }
        .award-weight { color: var(--accent-1); font-weight: 700; }

        /* Embedded Sheet */
        .embed-container {
            width: 100%;
            height: 500px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .embed-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
            margin-top: 2rem;
            font-size: 0.85rem;
        }

        footer a { color: var(--accent-1); text-decoration: none; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <a href="https://tenken73.github.io" class="logo">üöÄ Bebop Protocol</a>
        <ul class="nav-links">
            <li><a href="#" onclick="switchTab('home')" class="active"><i class="fas fa-home"></i><span class="nav-text">Home</span></a></li>
            <li><a href="#" onclick="switchTab('shows')"><i class="fas fa-tv"></i><span class="nav-text">Shows</span></a></li>
            <li><a href="#" onclick="switchTab('metrics')"><i class="fas fa-chart-bar"></i><span class="nav-text">Metrics</span></a></li>
            <li><a href="#" onclick="switchTab('community')"><i class="fas fa-users"></i><span class="nav-text">Community</span></a></li>
        </ul>
    </nav>

    <main class="main-content">
        <div class="container">
            
            <!-- HOME TAB -->
            <div class="tab-content active" id="home">
                <h1 class="section-title"><i class="fas fa-satellite"></i> Bebop Protocol Dashboard</h1>
                
                <div class="grid-4" style="margin-bottom: 1.5rem;">
                    <div class="stat-card">
                        <div class="stat-number" id="totalAnime">127</div>
                        <div class="stat-label">Anime Tracked</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalGenres">18</div>
                        <div class="stat-label">Genres</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Data Sources</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgScore">8.2</div>
                        <div class="stat-label">Avg Score</div>
                    </div>
                </div>

                <!-- Featured Picks -->
                <h3 style="color: var(--accent-1); margin-bottom: 1rem;"><i class="fas fa-star"></i> Featured Picks</h3>
                <div class="featured-grid">
                    <div class="featured-card">
                        <div class="featured-image">üèÜ</div>
                        <div class="featured-info">
                            <h4>Anime of the Year</h4>
                            <p>Frieren: Beyond Journey's End</p>
                            <span class="featured-badge">Crunchyroll Winner 2024</span>
                        </div>
                    </div>
                    <div class="featured-card">
                        <div class="featured-image">üìà</div>
                        <div class="featured-info">
                            <h4>Top Rated</h4>
                            <p>Fullmetal Alchemist: Brotherhood</p>
                            <span class="featured-badge">MAL #1</span>
                        </div>
                    </div>
                    <div class="featured-card">
                        <div class="featured-image">üíé</div>
                        <div class="featured-info">
                            <h4>Hidden Gem</h4>
                            <p>Odd Taxi</p>
                            <span class="featured-badge">Underrated</span>
                        </div>
                    </div>
                    <div class="featured-card" id="newsCard">
                        <div class="featured-image">üì∞</div>
                        <div class="featured-info">
                            <h4>Latest News</h4>
                            <p id="latestNewsTitle">Loading...</p>
                            <span class="featured-badge">r/anime</span>
                        </div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h3><i class="fas fa-chart-pie"></i> Anime by Decade</h3>
                        <div class="chart-container">
                            <canvas id="decadeChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-chart-line"></i> Average Scores Over Time</h3>
                        <div class="chart-container">
                            <canvas id="scoreTimeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SHOWS TAB -->
            <div class="tab-content" id="shows">
                <h1 class="section-title"><i class="fas fa-tv"></i> Shows Database</h1>
                
                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="switchSubTab('shows-list')">Shows</button>
                    <button class="sub-tab" onclick="switchSubTab('characters')">Characters</button>
                </div>

                <!-- Shows List Sub-tab -->
                <div class="sub-content active" id="shows-list">
                    <div class="controls">
                        <div class="control-group">
                            <label>Search</label>
                            <input type="text" id="searchInput" placeholder="Search anime..." onkeyup="filterAnime()">
                        </div>
                        <div class="control-group">
                            <label>Genre</label>
                            <select id="genreFilter" onchange="filterAnime()">
                                <option value="all">All Genres</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Decade</label>
                            <select id="decadeFilter" onchange="filterAnime()">
                                <option value="all">All</option>
                                <option value="2020">2020s</option>
                                <option value="2010">2010s</option>
                                <option value="2000">2000s</option>
                                <option value="1990">1990s</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Sort By</label>
                            <select id="sortFilter" onchange="filterAnime()">
                                <option value="weighted">Weighted Score</option>
                                <option value="mal">MAL Score</option>
                                <option value="anilist">AniList Score</option>
                                <option value="my_score">My Score</option>
                                <option value="popularity">Popularity</option>
                            </select>
                        </div>
                    </div>

                    <div class="anime-list" id="animeList"></div>
                </div>

                <!-- Characters Sub-tab -->
                <div class="sub-content" id="characters">
                    <div class="controls">
                        <div class="control-group">
                            <label>Search Character</label>
                            <input type="text" id="charSearchInput" placeholder="Search character or VA...">
                        </div>
                        <div class="control-group" style="justify-content: flex-end;">
                            <button class="btn" onclick="searchCharacters()">Search</button>
                        </div>
                    </div>
                    <div id="charactersGrid" class="grid-3"></div>
                </div>
            </div>

            <!-- METRICS TAB -->
            <div class="tab-content" id="metrics">
                <h1 class="section-title"><i class="fas fa-chart-bar"></i> Metrics & Analysis</h1>
                
                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="switchSubTab('awards')">Awards</button>
                    <button class="sub-tab" onclick="switchSubTab('methodology')">Methodology</button>
                    <button class="sub-tab" onclick="switchSubTab('live-data')">Live Data</button>
                </div>

                <!-- Awards Sub-tab -->
                <div class="sub-content active" id="awards">
                    <h3 style="margin-bottom: 1rem;">Award Weights</h3>
                    <div class="grid-4" id="awardsGrid"></div>
                </div>

                <!-- Methodology Sub-tab -->
                <div class="sub-content" id="methodology">
                    <div class="card">
                        <h3>Weighted Score Formula</h3>
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; font-family: monospace; margin-bottom: 1rem;">
                            Weighted_Score = (0.35 √ó MAL) + (0.35 √ó AniList) + (0.15 √ó IMDb) + (0.05 √ó Kitsu) + (0.10 √ó Popularity)
                        </div>
                        <p style="color: var(--text-secondary);">All scores normalized to 0-100 scale before weighting.</p>
                    </div>
                    
                    <div class="card">
                        <h3>Award Score Formula</h3>
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; font-family: monospace;">
                            Award_Score = Œ£ (Award_Weight √ó Result)<br>
                            Where: Win = 1.0, Nominee = 0.5
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="card">
                            <h3>Data Sources</h3>
                            <ul style="color: var(--text-secondary); line-height: 2; margin-left: 1.5rem;">
                                <li><strong>MyAnimeList</strong> - Community scores</li>
                                <li><strong>AniList</strong> - API-friendly data</li>
                                <li><strong>IMDb</strong> - Western perspective</li>
                                <li><strong>Kitsu</strong> - Community-driven</li>
                            </ul>
                        </div>
                        <div class="card">
                            <h3>Analysis Types</h3>
                            <ul style="color: var(--text-secondary); line-height: 2; margin-left: 1.5rem;">
                                <li><strong>Critical Darling</strong> - High score, low popularity</li>
                                <li><strong>Western Favorite</strong> - Higher IMDb than JP</li>
                                <li><strong>Hidden Gem</strong> - Quality, low visibility</li>
                                <li><strong>Underrated</strong> - Score ‚â•9, low members</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Live Data Sub-tab -->
                <div class="sub-content" id="live-data">
                    <div class="card">
                        <h3><i class="fas fa-table"></i> Live Anime Database</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Updated live from Google Sheets</p>
                        <div class="embed-container">
                            <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRxxxxxxxx/pubhtml?widget=true&amp;headers=false"></iframe>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COMMUNITY TAB -->
            <div class="tab-content" id="community">
                <h1 class="section-title"><i class="fas fa-users"></i> Community</h1>
                
                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="switchSubTab('engagement')">Engagement</button>
                    <button class="sub-tab" onclick="switchSubTab('interaction')">Interaction</button>
                </div>

                <!-- Engagement Sub-tab -->
                <div class="sub-content active" id="engagement">
                    <h3 style="margin-bottom: 1rem;"><i class="fas fa-fire"></i> Trending This Week</h3>
                    <div class="grid-3" id="trendingGrid"></div>
                </div>

                <!-- Interaction Sub-tab -->
                <div class="sub-content" id="interaction">
                    <div class="grid-2">
                        <div class="card">
                            <h3><i class="fas fa-robot"></i> Anime Recommender</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                Enter your top 5 anime to get personalized recommendations based on voice actor patterns and genre analysis.
                            </p>
                            <div style="margin-bottom: 1rem;">
                                <input type="text" placeholder="Anime 1..." style="width: 100%; margin-bottom: 0.5rem;">
                                <input type="text" placeholder="Anime 2..." style="width: 100%; margin-bottom: 0.5rem;">
                                <input type="text" placeholder="Anime 3..." style="width: 100%; margin-bottom: 0.5rem;">
                                <input type="text" placeholder="Anime 4..." style="width: 100%; margin-bottom: 0.5rem;">
                                <input type="text" placeholder="Anime 5..." style="width: 100%;">
                            </div>
                            <button class="btn">Get Recommendations</button>
                        </div>

                        <div class="card">
                            <h3><i class="fas fa-question-circle"></i> Character Guesser</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                                Test your anime knowledge! Guess the character from clues.
                            </p>
                            <div id="guessGameDisplay" style="margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <p><strong>Clue:</strong> This character has gravity-defying pink hair and is known for superhuman strength.</p>
                            </div>
                            <input type="text" id="guessInput" placeholder="Your answer..." style="width: 100%; margin-bottom: 0.5rem;">
                            <button class="btn" onclick="checkGuess()">Submit Guess</button>
                            <div id="guessResult" style="margin-top: 0.5rem;"></div>
                        </div>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-poll"></i> Community Survey</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Rank these 5 anime from 1-5 based on what you would watch first:
                        </p>
                        <div id="surveyAnime" class="grid-3" style="margin-bottom: 1rem;"></div>
                        <button class="btn">Submit Rankings</button>
                    </div>
                </div>
            </div>

        </div>

        <footer>
			<p>Bebop Protocol v<span id="version">0.6.2</span> | Updated <span id="version-date"></span> | Built by <a href="https://tenken73.github.io">JeQa Powe</a></p></p>
            <p style="margin-top: 0.5rem;">Data: AniList ‚Ä¢ MAL ‚Ä¢ IMDb ‚Ä¢ Kitsu</p>
        </footer>
    </main>

    <!-- Modal -->
    <div class="modal" id="animeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Anime Title</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // ===========================================
        // ANIME DATA (Pull from Google Sheets in production)
        // ===========================================
        
        const animeData = [
            { id: 1, title: "Frieren: Beyond Journey's End", genres: "Adventure|Drama|Fantasy", year: 2023, episodes: 28, mal_score: 9.32, anilist_score: 91, my_score: 9.5, popularity: 12, status: "Finished", studio: "Madhouse", image: "üßô" },
            { id: 2, title: "Fullmetal Alchemist: Brotherhood", genres: "Action|Adventure|Drama|Fantasy", year: 2009, episodes: 64, mal_score: 9.09, anilist_score: 90, my_score: 10, popularity: 1, status: "Finished", studio: "Bones", image: "‚öóÔ∏è" },
            { id: 3, title: "Steins;Gate", genres: "Drama|Sci-Fi|Thriller", year: 2011, episodes: 24, mal_score: 9.07, anilist_score: 89, my_score: 9, popularity: 5, status: "Finished", studio: "White Fox", image: "‚è∞" },
            { id: 4, title: "Attack on Titan", genres: "Action|Drama|Fantasy|Mystery", year: 2013, episodes: 25, mal_score: 8.54, anilist_score: 84, my_score: 9, popularity: 3, status: "Finished", studio: "Wit Studio", image: "‚öîÔ∏è" },
            { id: 5, title: "Cowboy Bebop", genres: "Action|Adventure|Drama|Sci-Fi", year: 1998, episodes: 26, mal_score: 8.75, anilist_score: 86, my_score: 10, popularity: 25, status: "Finished", studio: "Sunrise", image: "üöÄ" },
            { id: 6, title: "Death Note", genres: "Mystery|Supernatural|Thriller", year: 2006, episodes: 37, mal_score: 8.62, anilist_score: 84, my_score: 9, popularity: 2, status: "Finished", studio: "Madhouse", image: "üìì" },
            { id: 7, title: "Jujutsu Kaisen", genres: "Action|Drama|Supernatural", year: 2020, episodes: 24, mal_score: 8.60, anilist_score: 86, my_score: 8.5, popularity: 8, status: "Finished", studio: "MAPPA", image: "üëä" },
            { id: 8, title: "Demon Slayer", genres: "Action|Fantasy|Supernatural", year: 2019, episodes: 26, mal_score: 8.44, anilist_score: 84, my_score: 8, popularity: 6, status: "Finished", studio: "ufotable", image: "üó°Ô∏è" },
            { id: 9, title: "One Punch Man", genres: "Action|Comedy|Parody", year: 2015, episodes: 12, mal_score: 8.50, anilist_score: 83, my_score: 8.5, popularity: 4, status: "Finished", studio: "Madhouse", image: "üë®‚Äçü¶≤" },
            { id: 10, title: "Odd Taxi", genres: "Drama|Mystery|Psychological", year: 2021, episodes: 13, mal_score: 8.58, anilist_score: 85, my_score: 9, popularity: 189, status: "Finished", studio: "OLM", image: "üöï" }
        ];

        // Calculate weighted scores
        animeData.forEach(a => {
            const malNorm = a.mal_score * 10;
            const alNorm = a.anilist_score;
            a.weighted_score = ((0.35 * malNorm) + (0.35 * alNorm) + (0.10 * (a.my_score * 10))) / 0.80;
        });

        const awards = [
            { name: "Crunchyroll", emoji: "üèÜ", weight: 10 },
            { name: "TAAF", emoji: "üéå", weight: 9 },
            { name: "Animation Kobe", emoji: "üèÖ", weight: 8 },
            { name: "Japan Media Arts", emoji: "üé®", weight: 8 },
            { name: "Mainichi Film", emoji: "üé¨", weight: 7 },
            { name: "Animage", emoji: "üì∞", weight: 7 },
            { name: "Newtype", emoji: "üì∫", weight: 6 },
            { name: "Seiyu Awards", emoji: "üé§", weight: 5 }
        ];

        // ===========================================
        // TAB SWITCHING
        // ===========================================
        
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.nav-links a[onclick*="${tabId}"]`).classList.add('active');
            
            if (tabId === 'home') initHomeCharts();
            if (tabId === 'shows') renderAnimeList();
            if (tabId === 'metrics') renderAwards();
            if (tabId === 'community') renderTrending();
        }

        function switchSubTab(subId) {
            const parent = document.getElementById(subId).parentElement;
            parent.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
            parent.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(subId).classList.add('active');
            event.target.classList.add('active');
        }

        // ===========================================
        // HOME CHARTS
        // ===========================================
        
        let decadeChart, scoreTimeChart;

        function initHomeCharts() {
            // Decade distribution
            const decadeCtx = document.getElementById('decadeChart');
            if (decadeCtx) {
                if (decadeChart) decadeChart.destroy();
                
                const decades = { '1990s': 0, '2000s': 0, '2010s': 0, '2020s': 0 };
                animeData.forEach(a => {
                    if (a.year >= 2020) decades['2020s']++;
                    else if (a.year >= 2010) decades['2010s']++;
                    else if (a.year >= 2000) decades['2000s']++;
                    else decades['1990s']++;
                });
                
                decadeChart = new Chart(decadeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(decades),
                        datasets: [{
                            data: Object.values(decades),
                            backgroundColor: ['#667eea', '#764ba2', '#f56565', '#48bb78']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'right', labels: { color: '#e2e8f0' } }
                        }
                    }
                });
            }
            
            // Score over time
            const scoreCtx = document.getElementById('scoreTimeChart');
            if (scoreCtx) {
                if (scoreTimeChart) scoreTimeChart.destroy();
                
                scoreTimeChart = new Chart(scoreCtx, {
                    type: 'line',
                    data: {
                        labels: ['1990s', '2000s', '2010s', '2020s'],
                        datasets: [{
                            label: 'Avg MAL Score',
                            data: [8.4, 8.5, 8.6, 8.7],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102,126,234,0.2)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { min: 8, max: 9, ticks: { color: '#a0aec0' }, grid: { color: 'rgba(102,126,234,0.1)' } },
                            x: { ticks: { color: '#a0aec0' }, grid: { display: false } }
                        },
                        plugins: { legend: { labels: { color: '#e2e8f0' } } }
                    }
                });
            }
            
            // Update stats
            document.getElementById('totalAnime').textContent = animeData.length;
            const genres = new Set();
            animeData.forEach(a => a.genres.split('|').forEach(g => genres.add(g)));
            document.getElementById('totalGenres').textContent = genres.size;
            
            const avgScore = (animeData.reduce((sum, a) => sum + a.mal_score, 0) / animeData.length).toFixed(1);
            document.getElementById('avgScore').textContent = avgScore;
        }

        // ===========================================
        // ANIME LIST
        // ===========================================
        
        function renderAnimeList(data = animeData) {
            const container = document.getElementById('animeList');
            if (!container) return;
            
            container.innerHTML = data.map(a => `
                <div class="anime-item" onclick="openAnimeModal(${a.id})">
                    <div class="anime-poster">${a.image}</div>
                    <div class="anime-info">
                        <div class="anime-title">${a.title}</div>
                        <div class="anime-meta">${a.genres.replace(/\|/g, ' ‚Ä¢ ')} ‚Ä¢ ${a.year} ‚Ä¢ ${a.episodes} eps</div>
                        <div style="margin-top: 0.5rem;">
                            ${a.genres.split('|').slice(0, 3).map(g => `<span class="tag">${g}</span>`).join('')}
                        </div>
                    </div>
                    <div class="anime-scores">
                        <div class="score-box">
                            <div class="score-value">${a.weighted_score.toFixed(1)}</div>
                            <div class="score-label">Weighted</div>
                        </div>
                        <div class="score-box">
                            <div class="score-value">${a.mal_score}</div>
                            <div class="score-label">MAL</div>
                        </div>
                        <div class="score-box">
                            <div class="score-value">${a.anilist_score}</div>
                            <div class="score-label">AL</div>
                        </div>
                        <div class="score-box">
                            <div class="score-value">${a.my_score}</div>
                            <div class="score-label">My</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Populate genre filter
            const genreFilter = document.getElementById('genreFilter');
            if (genreFilter && genreFilter.options.length <= 1) {
                const genres = new Set();
                animeData.forEach(a => a.genres.split('|').forEach(g => genres.add(g)));
                [...genres].sort().forEach(g => {
                    const opt = document.createElement('option');
                    opt.value = g.toLowerCase();
                    opt.textContent = g;
                    genreFilter.appendChild(opt);
                });
            }
        }

        function filterAnime() {
            const search = document.getElementById('searchInput')?.value.toLowerCase() || '';
            const genre = document.getElementById('genreFilter')?.value || 'all';
            const decade = document.getElementById('decadeFilter')?.value || 'all';
            const sort = document.getElementById('sortFilter')?.value || 'weighted';
            
            let filtered = animeData.filter(a => {
                const matchSearch = a.title.toLowerCase().includes(search);
                const matchGenre = genre === 'all' || a.genres.toLowerCase().includes(genre);
                const matchDecade = decade === 'all' || (a.year >= parseInt(decade) && a.year < parseInt(decade) + 10);
                return matchSearch && matchGenre && matchDecade;
            });
            
            filtered.sort((a, b) => {
                if (sort === 'weighted') return b.weighted_score - a.weighted_score;
                if (sort === 'mal') return b.mal_score - a.mal_score;
                if (sort === 'anilist') return b.anilist_score - a.anilist_score;
                if (sort === 'my_score') return b.my_score - a.my_score;
                if (sort === 'popularity') return a.popularity - b.popularity;
                return 0;
            });
            
            renderAnimeList(filtered);
        }

        // ===========================================
        // AWARDS
        // ===========================================
        
        function renderAwards() {
            const grid = document.getElementById('awardsGrid');
            if (!grid) return;
            
            grid.innerHTML = awards.map(a => `
                <div class="award-card">
                    <div class="award-emoji">${a.emoji}</div>
                    <div class="award-name">${a.name}</div>
                    <div class="award-weight">Weight: ${a.weight}</div>
                </div>
            `).join('');
        }

        // ===========================================
        // TRENDING
        // ===========================================
        
        function renderTrending() {
            const grid = document.getElementById('trendingGrid');
            if (!grid) return;
            
            const trending = animeData.slice(0, 5).map(a => `
                <div class="card" style="cursor: pointer;" onclick="openAnimeModal(${a.id})">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 2rem;">${a.image}</div>
                        <div>
                            <h4 style="margin-bottom: 0.25rem;">${a.title}</h4>
                            <p style="color: var(--text-secondary); font-size: 0.85rem;">${a.studio} ‚Ä¢ ${a.year}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            grid.innerHTML = trending;
            
            // Survey anime
            const surveyGrid = document.getElementById('surveyAnime');
            if (surveyGrid) {
                surveyGrid.innerHTML = animeData.slice(0, 5).map((a, i) => `
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">${a.image}</div>
                        <h4>${a.title}</h4>
                        <select style="margin-top: 0.5rem; width: 100%;">
                            <option value="">Rank...</option>
                            <option value="1">1 (Watch First)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Watch Last)</option>
                        </select>
                    </div>
                `).join('');
            }
        }

        // ===========================================
        // MODAL
        // ===========================================
        
        function openAnimeModal(id) {
            const anime = animeData.find(a => a.id === id);
            if (!anime) return;
            
            document.getElementById('modalTitle').textContent = anime.title;
            document.getElementById('modalBody').innerHTML = `
                <div style="display: flex; gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div style="font-size: 5rem;">${anime.image}</div>
                    <div>
                        <p><strong>Studio:</strong> ${anime.studio}</p>
                        <p><strong>Year:</strong> ${anime.year}</p>
                        <p><strong>Episodes:</strong> ${anime.episodes}</p>
                        <p><strong>Status:</strong> ${anime.status}</p>
                    </div>
                </div>
                <div style="margin-bottom: 1rem;">
                    ${anime.genres.split('|').map(g => `<span class="tag">${g}</span>`).join('')}
                </div>
                <div class="grid-4" style="margin-bottom: 1rem;">
                    <div class="stat-card">
                        <div class="score-value">${anime.weighted_score.toFixed(1)}</div>
                        <div class="score-label">Weighted</div>
                    </div>
                    <div class="stat-card">
                        <div class="score-value">${anime.mal_score}</div>
                        <div class="score-label">MAL</div>
                    </div>
                    <div class="stat-card">
                        <div class="score-value">${anime.anilist_score}</div>
                        <div class="score-label">AniList</div>
                    </div>
                    <div class="stat-card">
                        <div class="score-value">${anime.my_score}</div>
                        <div class="score-label">My Score</div>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <a href="https://myanimelist.net/anime/${anime.id}" target="_blank" class="btn">View on MAL</a>
                    <a href="https://anilist.co/anime/${anime.id}" target="_blank" class="btn" style="background: var(--accent-2);">View on AniList</a>
                </div>
            `;
            
            document.getElementById('animeModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('animeModal').classList.remove('active');
        }

        function checkGuess() {
            const guess = document.getElementById('guessInput').value.toLowerCase();
            const result = document.getElementById('guessResult');
            
            if (guess.includes('sakura') || guess.includes('haruno')) {
                result.innerHTML = '<p style="color: #48bb78;">‚úì Correct! Sakura Haruno from Naruto!</p>';
            } else {
                result.innerHTML = '<p style="color: #f56565;">‚úó Not quite! Hint: She\'s from one of the "Big 3" anime.</p>';
            }
        }

        function searchCharacters() {
            const query = document.getElementById('charSearchInput').value;
            const grid = document.getElementById('charactersGrid');
            
            grid.innerHTML = `
                <div class="card">
                    <h4>Spike Spiegel</h4>
                    <p style="color: var(--text-secondary);">Cowboy Bebop</p>
                    <p style="font-size: 0.85rem; margin-top: 0.5rem;">VA (JP): Koichi Yamadera</p>
                    <p style="font-size: 0.85rem;">VA (EN): Steve Blum</p>
                </div>
                <div class="card">
                    <h4>Edward Elric</h4>
                    <p style="color: var(--text-secondary);">Fullmetal Alchemist</p>
                    <p style="font-size: 0.85rem; margin-top: 0.5rem;">VA (JP): Romi Park</p>
                    <p style="font-size: 0.85rem;">VA (EN): Vic Mignogna</p>
                </div>
                <div class="card">
                    <h4>L Lawliet</h4>
                    <p style="color: var(--text-secondary);">Death Note</p>
                    <p style="font-size: 0.85rem; margin-top: 0.5rem;">VA (JP): Kappei Yamaguchi</p>
                    <p style="font-size: 0.85rem;">VA (EN): Alessandro Juliani</p>
                </div>
            `;
        }

        // ===========================================
        // INIT
        // ===========================================
        
        document.addEventListener('DOMContentLoaded', () => {
            initHomeCharts();
            renderAnimeList();
            
            // Close modal on outside click
            document.getElementById('animeModal').addEventListener('click', (e) => {
                if (e.target.id === 'animeModal') closeModal();
            });
        });
    </script>
</body>
</html>
